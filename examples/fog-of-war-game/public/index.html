<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fog of War: Parallel Minds - Live Dashboard</title>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            font-size: 1.4em;
        }

        .team-red { border-left: 4px solid #ff4444; }
        .team-blue { border-left: 4px solid #4488ff; }

        .commander-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 3px solid;
        }

        .commander-card.red { border-left-color: #ff4444; }
        .commander-card.blue { border-left-color: #4488ff; }

        .commander-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .commander-role {
            font-size: 0.9em;
            opacity: 0.7;
            text-transform: uppercase;
        }

        .stats {
            margin-top: 10px;
            font-size: 0.9em;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
        }

        .game-map {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 2px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }

        .map-tile {
            aspect-ratio: 1;
            background: #2a2a2a;
            border: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .map-tile:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .map-tile.red { background: #ff4444; }
        .map-tile.blue { background: #4488ff; }
        .map-tile.neutral { background: #666; }

        .control-bar {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
        }

        .control-item {
            text-align: center;
        }

        .control-label {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .control-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .activity-log {
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }

        .log-entry {
            padding: 8px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            border-left: 3px solid;
        }

        .log-entry.info { border-left-color: #4488ff; }
        .log-entry.action { border-left-color: #ffaa00; }
        .log-entry.battle { border-left-color: #ff4444; }
        .log-entry.system { border-left-color: #44ff44; }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .connection-status.connected {
            background: #44ff44;
            color: #000;
        }

        .connection-status.disconnected {
            background: #ff4444;
            color: #fff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulsing {
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="connection-status disconnected" id="connectionStatus">
        ‚óè Disconnected
    </div>

    <div class="container">
        <header>
            <h1>üéÆ Fog of War: Parallel Minds</h1>
            <p class="subtitle">Multi-Agent Strategy Game Demo ‚Ä¢ Powered by MXF</p>
        </header>

        <div class="control-bar">
            <div class="control-item">
                <div class="control-label">Turn</div>
                <div class="control-value" id="currentTurn">0</div>
            </div>
            <div class="control-item">
                <div class="control-label">Phase</div>
                <div class="control-value" id="currentPhase">Planning</div>
            </div>
            <div class="control-item">
                <div class="control-label">Red Control</div>
                <div class="control-value" id="redControl" style="color: #ff4444;">0%</div>
            </div>
            <div class="control-item">
                <div class="control-label">Blue Control</div>
                <div class="control-value" id="blueControl" style="color: #4488ff;">0%</div>
            </div>
            <div class="control-item">
                <div class="control-label">Winner</div>
                <div class="control-value" id="winner">-</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Red Team Panel -->
            <div class="panel team-red">
                <h2>üî¥ Red Alliance</h2>
                <div id="redCommanders"></div>
            </div>

            <!-- Map Panel -->
            <div class="panel">
                <h2>üó∫Ô∏è Battle Map</h2>
                <div class="game-map" id="gameMap"></div>
            </div>

            <!-- Blue Team Panel -->
            <div class="panel team-blue">
                <h2>üîµ Blue Coalition</h2>
                <div id="blueCommanders"></div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="panel">
            <h2>üìã Activity Log</h2>
            <div class="activity-log" id="activityLog"></div>
        </div>
    </div>

    <script>
        // Connect to game server
        const socket = io('http://localhost:3002');

        let gameState = null;

        socket.on('connect', () => {
            console.log('Connected to game server');
            document.getElementById('connectionStatus').textContent = '‚óè Connected';
            document.getElementById('connectionStatus').className = 'connection-status connected';
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from game server');
            document.getElementById('connectionStatus').textContent = '‚óè Disconnected';
            document.getElementById('connectionStatus').className = 'connection-status disconnected';
        });

        socket.on('gameState', (state) => {
            gameState = state;
            updateDashboard();
        });

        socket.on('action', (data) => {
            addLog('action', `${data.commanderId}: ${data.action}`);
        });

        socket.on('turnProgress', (progress) => {
            addLog('info', `Turn progress: ${progress.ready}/${progress.total} ready`);
        });

        socket.on('turnComplete', (data) => {
            gameState = data.newState;
            updateDashboard();
            addLog('system', `Turn ${data.turn} complete!`);
        });

        socket.on('gameOver', (data) => {
            addLog('battle', `üèÜ GAME OVER! Winner: ${data.winner}`);
            document.getElementById('winner').textContent = data.winner;
        });

        socket.on('commanderJoined', (data) => {
            addLog('system', `${data.name} joined the game (${data.team} ${data.role})`);
        });

        function updateDashboard() {
            if (!gameState) return;

            // Update control bar
            document.getElementById('currentTurn').textContent = gameState.turn;
            document.getElementById('currentPhase').textContent = gameState.phase;
            document.getElementById('redControl').textContent =
                gameState.resourceControl.red.toFixed(1) + '%';
            document.getElementById('blueControl').textContent =
                gameState.resourceControl.blue.toFixed(1) + '%';

            if (gameState.winner) {
                document.getElementById('winner').textContent = gameState.winner;
            }

            // Update commanders
            updateCommanders();

            // Update map
            updateMap();
        }

        function updateCommanders() {
            const redDiv = document.getElementById('redCommanders');
            const blueDiv = document.getElementById('blueCommanders');

            redDiv.innerHTML = '';
            blueDiv.innerHTML = '';

            gameState.commanders.forEach(commander => {
                const card = createCommanderCard(commander);
                if (commander.team === 'red') {
                    redDiv.appendChild(card);
                } else {
                    blueDiv.appendChild(card);
                }
            });
        }

        function createCommanderCard(commander) {
            const div = document.createElement('div');
            div.className = `commander-card ${commander.team}`;

            const totalUnits = commander.units.reduce((sum, u) => sum + u.count, 0);

            div.innerHTML = `
                <div class="commander-name">${commander.name}</div>
                <div class="commander-role">${commander.role}</div>
                <div class="stats">
                    <div class="stat-item">
                        <span>Resources:</span>
                        <span>${commander.resources}</span>
                    </div>
                    <div class="stat-item">
                        <span>Territories:</span>
                        <span>${commander.controlledTerritories.length}</span>
                    </div>
                    <div class="stat-item">
                        <span>Units:</span>
                        <span>${totalUnits}</span>
                    </div>
                    <div class="stat-item">
                        <span>Status:</span>
                        <span>${commander.status}</span>
                    </div>
                </div>
            `;

            return div;
        }

        function updateMap() {
            const mapDiv = document.getElementById('gameMap');
            mapDiv.innerHTML = '';

            for (let y = 0; y < 12; y++) {
                for (let x = 0; x < 12; x++) {
                    const tile = gameState.map[y][x];
                    const tileDiv = document.createElement('div');
                    tileDiv.className = `map-tile ${tile.owner}`;

                    const letter = String.fromCharCode(65 + x);
                    const number = y + 1;
                    tileDiv.title = `${letter}${number} - ${tile.terrain} - ${tile.owner}`;

                    // Show resource value
                    if (tile.resourceValue > 0) {
                        tileDiv.textContent = tile.resourceValue;
                    }

                    mapDiv.appendChild(tileDiv);
                }
            }
        }

        function addLog(type, message) {
            const logDiv = document.getElementById('activityLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;

            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;

            logDiv.insertBefore(entry, logDiv.firstChild);

            // Keep only last 50 entries
            while (logDiv.children.length > 50) {
                logDiv.removeChild(logDiv.lastChild);
            }
        }

        // Fetch initial game state
        fetch('http://localhost:3002/api/game/state')
            .then(res => res.json())
            .then(state => {
                gameState = state;
                updateDashboard();
                addLog('system', 'Dashboard connected to game server');
            })
            .catch(err => {
                console.error('Failed to fetch game state:', err);
                addLog('system', 'Failed to connect to game server');
            });
    </script>
</body>
</html>
